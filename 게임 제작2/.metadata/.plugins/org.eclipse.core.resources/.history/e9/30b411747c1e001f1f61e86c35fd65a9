package main;

import java.awt.Graphics2D;
import java.awt.image.BufferedImage;

import Entity.CommonEntity;

public class MonsterBattle extends CommonEntity {
    GamePanel gp;
    int playerFace = 0;
    public CommonEntity entity;

    public MonsterBattle(GamePanel gp) {
        super(gp);
        this.gp = gp;
    }

	public int Battle(CommonEntity entity, Graphics2D g2) {
		this.entity = entity;
		BattlePlayerCondition(entity, g2);

		if (gp.ui.dialogueIndex < gp.ui.mManager.battleMonologues.length) {
			gp.ui.currentDialogue = gp.ui.mManager.battleMonologues[gp.ui.dialogueIndex].monologue;
			gp.ui.dialogueIndex++;
			gp.ui.drawDialogueScreen(g2);
			gp.keyH.waitForEnter();
		}

		if (entity.speed > gp.player.speed) {
			gp.player.HP -= entity.attack;
			gp.ui.drawBattle(g2);
			if (gp.player.HP <= 0) {
				return 0; // 몬스터가 이겼습니다.
			}
			gp.ui.drawBattle(g2);
			
		} else {
			entity.HP -= gp.player.attack;
			gp.ui.drawBattle(g2);
			gp.player.HP -= entity.attack;
			gp.ui.drawBattle(g2);
			if (entity.HP <= 0) {
				return 1; // 플레이어가 이겼습니다.
			}
			gp.player.HP -= entity.attack;

		}
		return entity.HP <= 0 ? 1 : 0; // 플레이어가 이겼다면 1, 아니면 0을 반환
	}

    public void BattlePlayerCondition(CommonEntity entity, Graphics2D g2) {
        if (gp.player.HP >= gp.player.maxLife * 0.8)
            playerFace = 0;
        else if (gp.player.HP >= gp.player.maxLife * 0.5)
            playerFace = 2;
        else if (gp.player.HP >= gp.player.maxLife * 0.2)
            playerFace = 3;
        gp.playerImages.drawPlayerImg(40, 150, playerFace, g2);

        int monsterSize = 800 / 2 - gp.getOrigianlCharacterSize() * 3;

        BufferedImage image = null;
        // 객체를 화면에 그리기 위해 화면 좌표를 계산합니다.
        int screenX = worldX - gp.player.worldX + gp.player.screenX;
        int screenY = worldY - gp.player.worldY + gp.player.screenY;

        // 방향에 따라 이미지 선택
        BufferedImage image1 = null;

        switch (direction) {
        case ("nothing") -> {
            // 정지 상태일 때 이미지 선택
            if (spriteNum == 1)
                image1 = st1;
            else if (spriteNum == 2)
                image1 = st2;
            else if (spriteNum == 3)
                image1 = st3;
            else if (spriteNum == 4)
                image1 = st4;
            break;
        }
        case ("up") -> {
            // 위쪽 이동 상태일 때 이미지 선택
            if (spriteNum == 1)
                image1 = right1;
            else if (spriteNum == 2)
                image1 = right2;
            else if (spriteNum == 3)
                image1 = right3;
            else if (spriteNum == 4)
                image1 = right4;
            break;
        }
        case ("down") -> {
            // 아래쪽 이동 상태일 때 이미지 선택
            if (spriteNum == 1)
                image1 = right1;
            else if (spriteNum == 2)
                image1 = right2;
            else if (spriteNum == 3)
                image1 = right3;
            else if (spriteNum == 4)
                image1 = right4;
            break;
        }
        case ("right") -> {
            // 오른쪽 이동 상태일 때 이미지 선택
            if (spriteNum == 1)
                image1 = right1;
            else if (spriteNum == 2)
                image1 = right2;
            else if (spriteNum == 3)
                image1 = right3;
            else if (spriteNum == 4)
                image1 = right4;
            break;
        }
        case ("left") -> {
            // 왼쪽 이동 상태일 때 이미지 선택
            if (spriteNum == 1)
                image1 = left1;
            else if (spriteNum == 2)
                image1 = left2;
            else if (spriteNum == 3)
                image1 = left3;
            else if (spriteNum == 4)
                image1 = left4;
            break;
        }
        }

        // 이미지 그리기
        g2.drawImage(image1, screenX, screenY, gp.getOrigianlCharacterSize(), gp.getOrigianlCharacterSize(), null);
    }
}
